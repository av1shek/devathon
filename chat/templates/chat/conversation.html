{% extends 'feed/base.html' %}

{% load static %}
{% block css %} 
<link rel="stylesheet" type="text/css" href="{% static 'chat/conversation.css' %}">
{% endblock %}


{% block container %}

<h1>Chats : </h1><br>
<div id="all-msg">

	{% for message in messages %}
	<div>
		<h3> {{ message.content }} </h3> <br>
		<h6> {{ message.sender }} to {{ message.receiver }} : </h6>
	</div>
	<hr>
	{% endfor %}

</div>





<input type=text name=msg id="msg">
</input>
<button type=button id="send"> Send</button>



{% block script %}
<script type="text/javascript">

async function updateMessage(url, msg)
{
	var csrftoken = "{{csrf_token}}";

	const obj = {msg: msg};
	const data = JSON.stringify(obj);

	let params = {
				method: 'POST',
				body: data,
				headers: { 'Accept': 'application/json, text/plain',
					'Content-Type': 'application/json',
					"X-CSRFToken": csrftoken },
				}
	
	
	await fetch(url, params).then(response => response.json()).then(data => {messages=data; return messages;} );
	return messages;
}

function card(message)
{
	return `<div>
		<h3> ${ message.content } </h3> <br>
		<h6> ${ message.sender } to ${ message.receiver } : ${message.timestamp}</h6>
	</div>
	<hr>`;
}
document.getElementById("send").addEventListener("click", function() {

	let msg = document.getElementById('msg').value;
	let chatbox = document.getElementById('all-msg');

	let url = "";

	chatbox.innerHTML = "";
	updateMessage(url, msg).then(messages => {
		
		for(i=0; i<messages.length; i++)
		{
		   message = messages.at(i);
		   chatbox.innerHTML += card(message)
		   console.log(message);
		}
		console.log("message is ", messages)
	})
});




	</script>
{% endblock script %}
{% endblock %}